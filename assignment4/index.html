<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
	<link rel="stylesheet" type="text/css" href="style.css" />
	<title>Pretty lines!</title>

	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="gl.js"></script>
	<script type="text/javascript" src="cad.js"></script>
	
	<!--<script id="vertex-shader" type="x-shader/x-vertex">
	attribute vec4 vPosition;
	//attribute vec4 verColor;
	varying vec4 vColor;
	uniform mat4 camera;
	uniform mat4 translation;
	uniform mat4 scale;
	uniform mat4 rotation;
	uniform vec4 color;
	/* Normal shader */
	void
	main()
	{
	    gl_Position =  camera * translation * rotation * scale * (vPosition);
	    
	    /**if(wireColor.a>0.1){
    		vColor = wireColor;
    	}else{
    		vColor = verColor;
    	}*/
    	vColor = color;
	    
	}
	</script>!-->

	<!--<script id="fragment-shader" type="x-shader/x-fragment">
	precision mediump float;
	varying vec4 vColor;
	void
	main()
	{
	    gl_FragColor = vColor;//vec4( 1.0, 0.0, 0.0, 1.0 );
	}
	</script>!-->
	
	<script id="vertex-shader" type="x-shader/x-vertex">
		attribute  vec4 vPosition;
		attribute  vec3 vNormal;
		varying vec4 fColor;

		uniform vec4 ambientProduct, diffuseProduct, specularProduct;
		uniform float shininess;

		uniform mat4 locMatrix;
		uniform mat4 rotateMatrix;
		uniform mat4 scaleMatrix;

		uniform mat4 cameraMatrix;
		uniform mat4 projectionMatrix;
		
		uniform mat4 lightMatrix_0,lightMatrix_1,lightMatrix_2,lightMatrix_3;
		uniform vec4 lightPosition_0,lightPosition_1,lightPosition_2,lightPosition_3;


		mat4 selectLightMatrix(int lightIndex){
			if(lightIndex==0){
				return lightMatrix_0;
			}else if(lightIndex==1){
				return lightMatrix_1;
			}else if(lightIndex==2){
				return lightMatrix_2;
			}else{
				return lightMatrix_3;
			}
		}

		vec4 selectLightPosition(int lightIndex){
			if(lightIndex==0){
				return lightPosition_0;
			}else if(lightIndex==1){
				return lightPosition_1;
			}else if(lightIndex==2){
				return lightPosition_2;
			}else{
				return lightPosition_3;
			}
		}

		void main()
		{
			
			mat4 modelViewMatrix = cameraMatrix * locMatrix * rotateMatrix * scaleMatrix;//translation * rotation * scale
			vec3 pos = -(modelViewMatrix *vPosition).xyz;

			vec4 mixedAmbient, mixedDiffuse, mixedSpecular;

			fColor = ambientProduct;
			

			for(int c=0;c<4;c++){
				mat4 lightMatrix = selectLightMatrix(c);
				vec4 lightPos = selectLightPosition(c);

				if(lightPos!=vec4(0,0,0,1)){
					vec3 light = (modelViewMatrix * lightMatrix * lightPos).xyz;
			    	vec3 L = normalize( light - pos );
					
					//fixed light postion
				    vec3 E = normalize( -pos );
				    vec3 H = normalize( L + E );
				    
				    vec4 NN = vec4(vNormal,0);

				    // Transform vertex normal into eye coordinates
				       
				    vec3 N = normalize( (modelViewMatrix*NN).xyz);

				    // Compute terms in the illumination equation
				    //vec4 ambient = ambientProduct;

				    float Kd = max( dot(L, N), 0.0 );
				    vec4  diffuse = Kd*diffuseProduct;

				    float Ks = pow( max(dot(N, H), 0.0), shininess );
				    vec4  specular = Ks * specularProduct;
				    
				    if( dot(L, N) < 0.0 ) {
					specular = vec4(0.0, 0.0, 0.0, 1.0);
				    } 

				    fColor = fColor + diffuse + specular;
				}
			}
			
		    gl_Position = projectionMatrix * modelViewMatrix * vPosition;
		    //fColor = ambient + diffuse +specular;
		    
		    fColor.a = 1.0;

		    
		    
		    

		    
		}


	</script>

	<script id="fragment-shader" type="x-shader/x-fragment">

		precision mediump float;


		varying vec4 fColor;

		void
		main()
		{
		    gl_FragColor = fColor;
		}
	</script>
	<!--<script type="text/javascript" src="all.js"></script>!-->
	<script type="text/javascript">
		$().ready(function(){
			startCAD('gl-canvas');
		});
	</script>
</head>   

	<body>
	    <canvas id="gl-canvas">
	        Oops ... your browser doesn't support the HTML5 canvas element
	    </canvas>
		<div id="left-panel" class="floating-window">
			<h1>Scene</h1>
			<p>Create
				<select id="mesh-type-selector">
					
				</select>
			</p>
			<div id="object-picker">
				<h1>Mesh list</h1>
				<div id="object-list"></div>
			</div>
		</div>
		<div id="right-panel" class="floating-window">
			<div id="object-properties"></div>
		</div>
	</body>
</html>
